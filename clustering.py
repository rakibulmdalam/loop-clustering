import numpy as np
import ast
from ts_cluster import TSCluster
from sklearn.cluster import KMeans
from sklearn.metrics import silhouette_samples, silhouette_score

from matplotlib import pyplot as plt

def DTWDistance(s1,s2,w=None):
    '''
    Calculates dynamic time warping Euclidean distance between two
    sequences. Option to enforce locality constraint for window w.
    '''
    DTW={}

    if w:
        w = max(w, abs(len(s1)-len(s2)))

        for i in range(-1,len(s1)):
            for j in range(-1,len(s2)):
                DTW[(i, j)] = float('inf')

    else:
        for i in range(len(s1)):
            DTW[(i, -1)] = float('inf')
        for i in range(len(s2)):
            DTW[(-1, i)] = float('inf')

    DTW[(-1, -1)] = 0

    for i in range(len(s1)):
        if w:
            for j in range(max(0, i-w), min(len(s2), i+w)):
                dist= (s1[i]-s2[j])**2
                DTW[(i, j)] = dist + min(DTW[(i-1, j)],DTW[(i, j-1)], DTW[(i-1, j-1)])
        else:
            for j in range(len(s2)):
                dist= (s1[i]-s2[j])**2
                DTW[(i, j)] = dist + min(DTW[(i-1, j)],DTW[(i, j-1)], DTW[(i-1, j-1)])

    return np.sqrt(DTW[len(s1)-1, len(s2)-1])


def cluster(data, num_clusters=3, num_iters=10, window=1, optimize=False, plot=False):

    # all_scores = []
    # for i in range(30):
    #     d1 = data[i]
    #     scores = []
    #     for j in range(30):
    #         if j != i:
    #             d2 = data[j]
    #             score = DTWDistance(d1, d2, 1)
    #             scores.append(score)
    #     all_scores.append(scores)

    # print all_scores
    all_scores = [[3829.2399376377552, 344.2117807397068, 8961.0800269833544, 1158.2432818713, 7891.3341552617067, 8140.2956641635565, 4864.0596727425127, 2538.4374130555198, 2162.2573274242823, 7703.2969727253794, 2985.4529388352448, 6989.7265504453035, 3055.2149269732236, 8950.5567424602141, 2478.9772588710853, 8058.9689942324512, 7140.7103113065723, 7599.1674543991985, 8241.9773567997618, 8058.7303590578085, 1923.7421214913395, 6728.8270337407248, 6186.6456581899047, 790.35972822506585, 1226.8903781512022, 9692.3489413041661, 9685.2931034636222, 6468.4862409995121, 8734.0817777256925], [3827.2468564230344, 3903.671829188514, 5165.1967774713094, 4975.5749416524723, 4107.2116453866847, 4353.362120246833, 1299.7602663568387, 3280.5421807987777, 5446.0033051771097, 3905.3409902337594, 1630.6366854698199, 3191.8431979030547, 1363.0588762045461, 5146.9427575989221, 4060.8264245101636, 4255.8048886197776, 3335.7179512063067, 3782.5609710882386, 4434.2923336198755, 4264.3704107406056, 5770.4184423662036, 10505.168942001837, 2463.9061467515357, 3639.5701669290565, 4048.052494718911, 5900.0525633251773, 5893.4121059026575, 2649.5447722203148, 4982.8164224663142], [394.37830822701187, 3920.2638622929453, 9068.4237329317602, 1088.5144693572061, 7997.4484368453413, 8247.0661298427822, 4949.022302435098, 2505.5663032536177, 2056.2543616975017, 7808.6583994947559, 3009.8125356905534, 7097.3028679914742, 3078.0883678023279, 9057.5960938871631, 2407.3386757994813, 8166.6529863830992, 7248.7807940370221, 7701.8928679903102, 8349.0636001889452, 8164.2614332222356, 1879.1742202361122, 6666.9855069588984, 6276.7491586011301, 929.84071216526115, 1128.5131811370215, 9797.7714813114526, 9790.6270738906205, 6573.3550033449437, 8843.2389286957532], [8958.1295341159257, 5163.4746053408644, 9064.773549295096, 10139.108984521274, 1073.1958115833288, 820.27114419562508, 4196.0054814072873, 8147.2910835442717, 10594.549955047642, 1321.7521515019373, 6507.5741832114372, 1984.7317828865441, 6185.8736852606362, 136.23050319219993, 8918.3957217652096, 960.446771039395, 1906.9178010601297, 1426.058028272342, 775.35169439422782, 1022.0243392405094, 10930.299732852709, 15679.118350532341, 2818.8691881674822, 8744.4665217496258, 9216.907914262787, 744.48102729351001, 739.17437049724606, 2508.1663122687855, 989.97512595014223], [1206.4088237409408, 4990.6387366748959, 1049.9888094641772, 10142.831076676768, 9072.6966360614078, 9320.3773796987425, 6012.2988947656286, 3196.2475263971655, 1547.3163057371301, 8881.9136310819868, 4021.4783973061449, 8172.8629163837077, 4099.4177330445355, 10131.561886007506, 2868.7494226578938, 9239.6201355899902, 8325.1023266984539, 8774.8874351754512, 9422.7061266920555, 9236.5006631299493, 903.85189605377275, 5638.9793402707191, 7348.1418569594862, 1630.9360809056866, 1559.8487907486417, 10870.912461702559, 10863.73148370301, 7650.3767717675182, 9912.2613716548058], [7887.0923666456447, 4106.2182723279584, 7991.2170380987654, 1073.0227164417349, 9066.5417194209167, 311.87577655213943, 3176.5893659709936, 7146.589151476388, 9549.0403444534677, 590.47121013644687, 5486.9954665554442, 1020.8078908394076, 5144.4906696387352, 1072.6539516544933, 7907.5024027818035, 456.91793573901214, 994.52325261906265, 626.56244700747902, 535.08176945210903, 605.37013471098817, 9859.1582044310453, 14609.068194104646, 1803.0676637331169, 7678.0796427231726, 8160.6184201934111, 1795.1917028551575, 1788.6658435828645, 1493.3259021392485, 1270.7652222184868], [8137.709167818668, 4353.3989307206848, 8242.3126457323851, 822.60516045062593, 9316.3281259303021, 318.98315002520116, 3401.5715853117072, 7379.2712716094129, 9785.8402296379227, 686.24066478167845, 5721.9378273448583, 1212.2027470683277, 5377.3718022840858, 825.01196961013841, 8120.2011520651386, 456.87963403942621, 1213.617835234799, 732.13455047552566, 388.16394732123177, 520.99232240024423, 10110.372149431494, 14864.115025792824, 2017.156228456289, 7927.059101583638, 8405.1432022304052, 1544.7558059447454, 1537.8810097013359, 1717.8271158646903, 1120.5061356369272], [4905.324046380626, 1400.9090798477966, 4980.5153096843305, 4202.9696644158639, 6040.2663227708763, 3190.6207859913407, 3411.4595483458397, 4163.2266032489752, 6420.0753500251067, 2898.3679890586704, 2495.5804435040759, 2244.8739385542344, 1995.9035547841484, 4185.0275088701628, 4911.3649324805829, 3315.0745466731214, 2480.7923129516507, 2814.0354919581237, 3464.2235060688563, 3252.3895061938692, 6837.4387382995983, 11614.159310944551, 1389.2683326125302, 4725.4104583623212, 5134.1982090682868, 4932.3207265951387, 4926.1011966868891, 1838.9875611324835, 4035.0809161651268], [2596.5259964036563, 3316.9385357585388, 2533.404971574817, 8150.728955130332, 3218.1720354884696, 7151.4638012088126, 7382.7219404498774, 4103.9699072970798, 2892.7477854109575, 6839.2461207358228, 1703.2006634568929, 6180.2895360978036, 2558.6292228457019, 8121.1026344948996, 2097.9830194737037, 7244.8188038073113, 6304.4893924884991, 6742.7673287753305, 7395.1311854489777, 7194.0149429925432, 3814.9007195469712, 8108.3827610689423, 5457.6074199231298, 2608.78142051035, 1907.1065780390984, 8882.4340977009233, 8877.1162124870261, 5681.0287360653265, 7931.2257249431505], [2250.3683587359646, 5483.2174861115991, 2093.6286681262272, 10600.009988202841, 1639.2220715937178, 9555.9329084082619, 9791.298892383993, 6391.1964451110407, 2918.3198505304385, 9298.3860830791491, 4163.1387497896339, 8594.0451331139757, 4452.3601325589107, 10578.778792942028, 2334.1726050144621, 9693.2763939753622, 8770.450130979596, 9178.2109912553224, 9847.3070303509885, 9633.1315780487494, 1697.4564795599326, 5552.3277100689938, 7784.160519927631, 2552.3855018394065, 1716.8287625736004, 11330.951758347575, 11324.457768476157, 8086.7323437838595, 10377.237975492322], [7705.1434607020783, 3915.9883809837843, 7808.0269594821457, 1327.5342745104549, 8880.8742249848347, 609.17115821417542, 697.08033970267729, 2885.7111775089343, 6845.0962009309997, 9296.3273527775473, 5211.448814869048, 766.46738352000341, 4894.2062941809063, 1305.9396999861824, 7664.6054529897365, 537.26250567111049, 780.35777051298726, 379.53655950382432, 616.0058847121511, 522.04860884787342, 9669.3279885419124, 14421.998223200557, 1562.1366777590238, 7495.0863403966205, 7943.4073608244462, 2063.10488099854, 2058.2016422109859, 1311.5056233200069, 1405.6133003070227], [3044.1529199434117, 1718.6133218382779, 3044.7466643384305, 6512.0464525370207, 4050.9946618083809, 5495.8653322293112, 5727.6579419514919, 2443.7752556239702, 1763.9356564228754, 4171.521215336199, 5211.5526717092671, 4529.8920240994703, 1215.2079040230112, 6487.8975022729819, 2747.341806182842, 5617.3815296808889, 4684.2866852915822, 5103.9936814224211, 5764.9674110093629, 5557.4415651448826, 4811.1813777906982, 9446.7031815337559, 3782.8550395171105, 2973.2875323452995, 2872.705127575749, 7242.6316349790977, 7236.7445201554547, 4028.3264204877937, 6322.3787651484472], [6988.231661157206, 3200.47133247589, 7091.5915350505065, 1988.9603439988441, 8167.4690082056632, 1023.7997851142576, 1213.0347274501255, 2214.0117434196231, 6177.8424631905273, 8584.4183262466886, 750.42721166013166, 4519.2460377810812, 4213.5107392766904, 1972.24326592842, 6935.200141308108, 1156.161320923685, 626.46448422875494, 639.83064165449287, 1261.147592472824, 1075.1120871797507, 8956.274630112679, 13710.969613780055, 907.49710743340665, 6788.8129853458186, 7220.8749816071459, 2726.8093075974343, 2720.7891318512725, 626.14634870771226, 1966.6508968294297], [3153.8867291010943, 1519.0343972405628, 3173.7733063342757, 6192.4018966795102, 4179.4554071074854, 5158.7936574358155, 5388.5891474485234, 2002.6307073447167, 2670.5043531138458, 4526.8463360268815, 4905.94381847163, 1353.4194656498776, 4239.0154812173078, 6172.8631727910506, 3289.3617542009574, 5294.8881008006201, 4428.2500493987463, 4796.6936529238556, 5453.2218229226655, 5243.0683525965978, 4989.4511221175417, 9747.5718514920427, 3351.2766224231623, 3009.1359224867197, 3358.4495306614331, 6913.995769451989, 6907.3815950763865, 3767.1257279257352, 6000.9910848125746], [8947.7847398113008, 5144.1882741594909, 9053.8375841407706, 137.0164223733783, 10127.889883880058, 1071.7773789365028, 821.87681558734823, 4176.6285147233284, 8116.4176364945633, 10572.101009260174, 1298.253538412278, 6482.2681022925917, 1967.013027409834, 6164.4255815120359, 8899.9180614205652, 926.13781371888706, 1882.0955740875647, 1395.4718735968847, 737.69200890344473, 993.3670016665543, 10918.015032504763, 15665.379479923236, 2806.1003634937933, 8730.4599678367467, 9198.987308394333, 775.2235161551796, 770.82634231064003, 2488.4106875674684, 993.40437385789676], [2592.7103579073387, 4130.0456413942929, 2470.924422154591, 8925.6041952351879, 2938.3845902127923, 7915.9858356366458, 8128.8181951621973, 4882.5866351760724, 2188.0808942998428, 2403.8795206915011, 7672.1796609568519, 2752.3101206077777, 6956.4162109523031, 3215.8811001030494, 8910.3180358503487, 8095.8178092148291, 7203.2088682753047, 7522.3175617624656, 8198.5625264432783, 7948.1728403451316, 3486.6496812843129, 7669.4470139639143, 6186.0889906305101, 2827.1719526763845, 1941.4390925290445, 9626.7351293156498, 9619.9436198971562, 6477.3406966130788, 8751.3922606634424], [8052.7718054096131, 4251.9316198640827, 8159.7866393674776, 958.76235324505728, 9231.6130768138246, 456.41045123879451, 448.36759472557782, 3296.2258721149556, 7235.4651025348739, 9681.3448575081766, 504.4876113444214, 5605.8952674840439, 1138.2952165409463, 5277.9877557645013, 923.71681266500718, 8078.3719430340661, 998.83219311353798, 632.06566114605528, 321.85749952424595, 537.06750041312307, 10018.51449816788, 14760.620998115222, 1956.9362534329011, 7828.8912848499822, 8308.8428195507458, 1692.96596244579, 1688.2696763254382, 1631.8208388177914, 1132.4842162255507], [7128.3589801580556, 3328.124546948326, 7234.988113328176, 1904.8999973751902, 8310.6165234596156, 991.08412861875661, 1207.567389423878, 2433.3942343977064, 6285.7157110387998, 8747.8905314367075, 731.08241669458857, 4660.1157442707363, 573.24732882064086, 4392.7731844473828, 1880.231568185153, 7171.9123844341548, 992.14212691529235, 709.2369138729315, 1183.728537292229, 1122.9602619861489, 9091.9221977533434, 13815.598801716847, 1221.9573437726867, 6909.5824584413203, 7353.6399490320437, 2647.5688848451141, 2642.4815041926026, 801.64596300361916, 1848.3830771785376], [7601.5664997420108, 3793.9202680077501, 7700.9173966482722, 1432.2715350100343, 8773.428847947649, 640.36005496907751, 740.77628201772222, 2797.7473527822344, 6744.5720027293055, 9174.469902942621, 372.4157622872587, 5099.9729411046883, 654.95476943068365, 4780.3380633591178, 1405.3277197863849, 7508.4886961358607, 667.20517833721885, 753.68428403410405, 686.10257979401297, 532.05168921825634, 9565.4153072409772, 14318.797391890144, 1465.5148412759252, 7394.0386122876043, 7825.486710103085, 2155.6216620733799, 2149.8639491837616, 1181.463816627492, 1516.6058321132753], [8238.6786106753789, 4435.5883206176832, 8344.0734656401492, 779.10252855449005, 9418.0503555672294, 541.84891805742313, 391.14511373657729, 3449.7429614393013, 7391.6717493406049, 9840.0867501257326, 603.93935953868743, 5758.6588065277838, 1256.4900516916161, 5440.2422050860932, 743.97126960656215, 8184.2283081546548, 352.16295943781483, 1202.9329781829078, 674.37415430901558, 360.35850205038872, 10206.073204225022, 14955.305170741251, 2096.2980465573114, 8025.3065517773211, 8480.0104068332366, 1503.4807115490376, 1498.5701518447511, 1784.0727283381696, 1083.5021919682488], [8062.6963231911441, 4276.5605046579194, 8165.4188961742802, 1032.1769470396052, 9237.6048437893241, 630.90569818317545, 538.64854033033453, 3245.6677664234212, 7201.4651460657642, 9634.4782681783036, 537.77922979601954, 5560.1786167352575, 1098.0635227526684, 5235.4562360886948, 1005.8024159843721, 7943.3320149670189, 582.39698659934697, 1162.0506658489551, 555.37487339633935, 401.66683955736249, 10028.343881219869, 14789.817662838173, 1899.3360682090993, 7863.8533811357393, 8296.3419197860931, 1722.3666856973284, 1716.9724808511055, 1654.891235096736, 1294.5145808371569], [1919.7661967020879, 5775.75769921142, 1827.3135335787342, 10933.370454713404, 854.15674790989033, 9864.2018050118986, 10113.358480247796, 6804.4629839539875, 3770.6988410638155, 1550.2108727524781, 9668.6510693064101, 4768.7387221360741, 8959.0784124261354, 4906.8265457421667, 10920.971076328331, 3387.5412912612592, 10025.357599607109, 9104.5849713207681, 9564.2428215724431, 10210.336404839951, 10025.712032070342, 4810.8398435200479, 8149.2705041617064, 2293.8875844295421, 2115.2752184999472, 11664.673012990977, 11657.624200496428, 8435.93964831423, 10695.005072462565], [6676.6210765626047, 10492.177443219305, 6590.133629145922, 15680.120208404016, 5554.873850952873, 14609.744676071516, 14863.426270547447, 11570.270826562359, 8034.1377259790615, 5391.952591594255, 14416.005176539025, 9384.8392900464733, 13706.462554211426, 9664.497128666344, 15666.742936871084, 7537.8914160393688, 14764.192113014515, 13821.725028012965, 14312.750504357993, 14955.464828951322, 14782.370623482555, 4724.8044668536286, 12924.593426874209, 6914.4178532975575, 6518.1610136602176, 16415.465154847119, 16408.574229652007, 13166.499316447025, 15420.104822925166], [6215.0431213306956, 2514.7787178994495, 6300.9292370252815, 2826.3615303071192, 7369.8557143271128, 1825.204851516673, 2033.0047958625184, 1412.2822841061202, 5494.4537717593003, 7807.8515931080556, 1583.7225135736373, 3816.4879470528922, 972.08500142734431, 3362.5272489602221, 2814.5575584805511, 6212.5105231299203, 1980.0655923478898, 1287.5688331114575, 1493.5015902234586, 2114.4608059739485, 1911.5351160781745, 8174.0284743815273, 12954.916113198109, 6028.3443622606701, 6476.4842314329771, 3548.0149379617892, 3541.3550019731147, 772.76241497629792, 2730.1211511579481], [728.39446730463294, 3619.6052270931427, 755.28984502639776, 8746.4246266688879, 1529.1904721126143, 7678.655692893125, 7926.5565032995255, 4663.8875951291966, 2517.3040638746843, 2428.9352090988345, 7488.1435616579893, 2883.1300699066633, 6782.7362841260456, 2884.3836863357828, 8732.8553033930439, 2669.5577349066643, 7833.3753899580224, 6916.4681557858703, 7386.6342301483965, 8025.6358003587475, 7855.8736146911124, 2253.0781721902149, 6933.9170387307058, 5989.7956350780451, 1319.4071585375002, 9478.9658059305184, 9472.0421900453966, 6252.2534737484848, 8497.0287895240181], [1255.6633704938597, 4062.5594764876982, 1102.0085072266911, 9219.87737174416, 1551.5012890745531, 8163.7575600944938, 8407.1051498122706, 5079.696447623618, 1807.6659674840371, 1643.8356821775101, 7937.8134111353356, 2786.2037793384748, 7220.5845504363424, 3243.6133786257574, 9202.8882287029865, 1810.9118559444023, 8314.8755853590501, 7364.784484287371, 7822.3358403995926, 8482.1574790851409, 8289.5911841296493, 2146.9528988778493, 6590.3205536604974, 6439.6245232156198, 1413.5127342900028, 9955.627441301729, 9949.0589881656651, 6685.7063949892381, 8986.443401034694], [9692.0826967169451, 5899.8432182558881, 9797.4861188980522, 744.19654661923823, 10870.638067749289, 1794.8274290304346, 1544.379406104601, 4931.7969341812932, 8881.9431010336921, 11330.611258886256, 2062.6206631370683, 7242.0917385794, 2726.401336927489, 6913.4876690423043, 774.7857768441545, 9626.2443351496131, 1692.5281386139493, 2647.2509797901671, 2155.0433290307647, 1503.0971359163718, 1722.0169859789421, 11664.378669693469, 16415.248398973439, 3547.4025708960635, 9478.742743634306, 9955.2659934328221, 21.857492994394395, 3245.5495682549667, 1412.7675852736713], [9685.1313362287456, 5893.2446920181419, 9790.4559904020807, 738.90138042907995, 10863.612140996198, 1788.3244252651698, 1537.6228406211974, 4925.7288293205911, 8876.7512075082959, 11324.25563778918, 2057.8635158824309, 7236.3344657360885, 2720.4631499066477, 6907.0102975165746, 770.53001239406638, 9619.5932866208022, 1687.9359436898071, 2642.0873376934383, 2149.5586174840637, 1498.2455573102827, 1716.7591560845103, 11657.471767068535, 16408.504121339032, 3540.8155840145077, 9471.9481760617764, 9948.791723118944, 21.679483388678801, 3239.3691901356351, 1409.8062810187789], [6461.6529232078074, 2652.1355074731759, 6561.2935271941615, 2509.4106379785671, 7638.9437587928342, 1490.2457012184266, 1714.5412651785316, 1779.1514128932365, 5667.5936472192498, 8068.6393834400606, 1287.1085812782076, 4003.3734524772981, 587.62254041178505, 3723.8817784671951, 2491.0149036085672, 6444.2884401615665, 1636.4784599865652, 824.39841702904789, 1155.2295226490708, 1778.7179371671045, 1631.6213561975708, 8428.1832265322755, 13166.834509478731, 654.73506092159141, 6253.6968266778013, 6677.9712300967576, 3245.8837009356944, 3239.6827776805558, 2417.8369465288597], [8726.4199704116927, 4976.7677010284497, 8835.3023575879961, 985.92722855188458, 9903.6859173743997, 1263.8064527450397, 1113.3555137511109, 4022.9815435818246, 7923.0194055044449, 10366.978754680651, 1390.5307439966941, 6312.8694743357401, 1954.6261790940998, 5990.8392984622778, 989.95972140284573, 8737.9729056572378, 1127.4110829684087, 1846.1599334835539, 1501.6008124664825, 1073.6578831266504, 1278.4738949231619, 10686.866495844326, 15414.068590090028, 2717.8016851860257, 8491.258711168799, 8979.6052390959812, 1412.8614581762786, 1410.0593959121013, 2410.7174243365812]]

    for n_clusters in range(2,30):
        clusterer = KMeans(n_clusters=n_clusters, random_state=10)
        kmeans = clusterer.fit(all_scores)

        # print kmeans.labels_
        # print kmeans.inertia_
        # print kmeans.n_iter_
        # print kmeans.cluster_centers_
        silhouette_avg = silhouette_score(all_scores, kmeans.labels_)
        print("For n_clusters =", n_clusters, "The average silhouette_score is :", silhouette_avg)


# obj = TSCluster(num_clusters)
    # obj.k_means_clust(data, num_iters, window, optimize)
    # if plot:
    #     obj.plot_centroids()
    #
    # return obj.get_assignments(), obj.get_centroids()


def read_data(filename):
    data = []
    with open(filename) as file:
        i = 0
        for line in file:
            if i<30:
                line = line.strip()
                x = ast.literal_eval(line)
                data.append(x)
                i += 1
            else:
                break
    
    return data

def main(filename):
    # read data
    data = read_data(filename)
    # print len(data[0])
    cluster(data, 5, 10) # 5 clusters, 10 interations


if __name__ == '__main__':
    filename1 = 'medians_all.txt' # 2D list
    filename2 = 'diff_medians_all.txt' # 2D list
    main(filename1)



